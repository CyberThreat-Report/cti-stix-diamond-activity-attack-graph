import {
  addNodeViewTitleAndText,
  addNodeViewTitleAndTextList,
  BasicSDOSRO,
  customFieldView, externalReferencesView
} from "../basic";

export const MALWARE_ANALYSIS_TYPE = "malware-analysis";

export interface MalwareAnalysisSDO extends BasicSDOSRO {
  product: string;
  version?: string;
  host_vm_ref?: string;
  operating_system_ref?: string;
  installed_software_refs?: string [];
  configuration_version?: string;
  modules?: string [];
  analysis_engine_version?: string;
  analysis_definition_version?: string;
  submitted?: string; //timestamp
  analysis_started?: string; //timestamp
  analysis_ended?: string; //timestamp
  result_name?: string;
  result?: string;
  analysis_sco_refs?: string [];
  sample_ref?: string;
}

export function getMalwareAnalysisView(titleId: string, contentId: string, typeId: string,
                                       malwareAnalysisSDO: MalwareAnalysisSDO) {
  document.getElementById(titleId).innerHTML += malwareAnalysisSDO.product;
  document.getElementById(typeId).innerHTML += "Malware Analysis";

  let el = document.getElementById(contentId);
  const malwareAnalysisDIV = document.createElement("div");
  malwareAnalysisDIV.id = MALWARE_ANALYSIS_TYPE;

  if (malwareAnalysisSDO?.version) addNodeViewTitleAndText(malwareAnalysisDIV, "Version:",
    malwareAnalysisSDO.version);
  if (malwareAnalysisSDO?.configuration_version) addNodeViewTitleAndText(malwareAnalysisDIV,
    "Configuration version:", malwareAnalysisSDO.configuration_version);
  if (malwareAnalysisSDO?.modules) addNodeViewTitleAndTextList(malwareAnalysisDIV, "Modules:",
    malwareAnalysisSDO.modules, "badge-dark");
  if (malwareAnalysisSDO?.analysis_engine_version) addNodeViewTitleAndText(malwareAnalysisDIV,
    "Analysis engine version:", malwareAnalysisSDO.analysis_engine_version);
  if (malwareAnalysisSDO?.analysis_definition_version) addNodeViewTitleAndText(malwareAnalysisDIV,
    "Analysis definition version:", malwareAnalysisSDO.analysis_definition_version);
  if (malwareAnalysisSDO?.submitted) addNodeViewTitleAndText(malwareAnalysisDIV,
    "Submitted:", new Date(malwareAnalysisSDO.submitted).toString());
  if (malwareAnalysisSDO?.analysis_started) addNodeViewTitleAndText(malwareAnalysisDIV,
    "Analysis started:", new Date(malwareAnalysisSDO.analysis_started).toString());
  if (malwareAnalysisSDO?.analysis_ended) addNodeViewTitleAndText(malwareAnalysisDIV,
    "Analysis ended:", new Date(malwareAnalysisSDO.analysis_ended).toString());
  if (malwareAnalysisSDO?.result_name) addNodeViewTitleAndText(malwareAnalysisDIV,
    "Result name:", malwareAnalysisSDO.result_name);
  if (malwareAnalysisSDO?.result) addNodeViewTitleAndText(malwareAnalysisDIV,
    "Result:", malwareAnalysisSDO.result);

  el.appendChild(malwareAnalysisDIV);
  customFieldView(malwareAnalysisDIV.id, malwareAnalysisSDO);
  if (malwareAnalysisSDO?.external_references) {
    externalReferencesView(malwareAnalysisDIV.id, malwareAnalysisSDO.external_references);
  }
}
